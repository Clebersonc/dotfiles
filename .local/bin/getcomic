#!/bin/bash

function get_comic() {

	split=($1)
	name=${split[0]}
	number=${split[1]}
	url="https://getcomics.info/dc/${name}-${number}-2018/"
	download_url=$(curl "$url" | grep weekly1 | sed 's/.*href="//g' | sed 's/" class.*//g')

	if [ "$download_url" != '' ]; then
		n=$(("$number"+1))
		new="$name $n"
		$HOME/.local/bin/rpl "$1" "$new" "$HOME/Comics/comic_list.txt"
		wget "$download_url" -P ~/Comics/
		DISPLAY=:0 DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus notify-send -t 0 "New Comic" "$name #$number is ready for read!"
	fi
}

while read -r comic
do
	get_comic "$comic"
done < "$HOME/Comics/comic_list.txt"
