#!/bin/bash

function get_comic() {

	name=$1
	number=$2
	url="https://getcomics.info/dc/${name}-${number}-2018/"
	download_url=$(curl "$url" | grep weekly1 | sed -n 1p | sed 's/.*href="//g' | sed 's/" class.*//g')

	if [ "$download_url" != '' ]; then
		n=$(("$number"+1))
		new="$name $n"
		"$HOME/.local/bin/rpl" "$1 $2" "$new" "$HOME/Books/comics/comic_list.txt"
		wget "$download_url" -O ~/Books/comics/${name}/"${name}_${number}".cbr
		DISPLAY=:0 DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus notify-send -t 0 "New Comic" "<b>$name #$number</b> is ready for read!"
	fi
}

while read -r comic number
do
	get_comic "$comic" "$number"
done < "$HOME/Books/comics/comic_list.txt"
